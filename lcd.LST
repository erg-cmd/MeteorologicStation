C51 COMPILER V9.50a   LCD                                                                  12/12/2012 13:56:50 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN lcd.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lcd.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "libreria.h"
   2          
   3          
   4          void lcd_init(void)
   5          {
   6   1              wrt_cmd(0X38);
   7   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
   8   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
   9   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  10   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  11   1              busy();
  12   1              wrt_cmd(0X38);
  13   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
  14   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  15   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  16   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  17   1              busy();
  18   1              wrt_cmd(0X38);
  19   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
  20   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  21   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  22   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  23   1              busy();
  24   1              wrt_cmd(0X0C);
  25   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
  26   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  27   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  28   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  29   1              busy();
  30   1              wrt_cmd(0X01);
  31   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
  32   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  33   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  34   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  35   1              busy();
  36   1              wrt_cmd(0X06);
  37   1              clrbitp(P4,7,ACTIVO_ALTO);//rs=0;
  38   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  39   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  40   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  41   1              busy();
  42   1      }
  43          
  44          /*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  45          **** Cheacking the busy flag of LCD
  46          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
  47          
  48          void busy()
  49          {
  50   1              unsigned char i,j;
  51   1          for(i=0;i<50;i++)        //A simple loop for delay
  52   1              for(j=0;j<255;j++);
  53   1      }
  54          
  55          /*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
C51 COMPILER V9.50a   LCD                                                                  12/12/2012 13:56:50 PAGE 2   

  56                  Writing command to LCD 
  57          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
  58          
  59          void wrt_cmd(bit_8 val)
  60          {
  61   1              busy();
  62   1              LCD_PORT=val;
  63   1              clrbitp(P4,7,ACTIVO_ALTO); //rs=0;
  64   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  65   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  66   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  67   1      }
  68          
  69          /*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  70                  Writing string to LCD
  71          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
  72          
  73          void wrt_string(bit_8 *string)
  74          {
  75   1              busy();
  76   1              while(*string)
  77   1                      wrt_data(*string++);
  78   1      }
  79          
  80          /*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  81                  Writing data to LCD
  82          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
  83          
  84          void wrt_data(bit_8 ch)
  85          {
  86   1              busy();
  87   1              LCD_PORT = ch;
  88   1              setbitp(P4,7,ACTIVO_ALTO);//rs=1;
  89   1              clrbitp(P7,6,ACTIVO_ALTO);//rw=0;
  90   1              setbitp(P4,6,ACTIVO_ALTO);//en=1;
  91   1              clrbitp(P4,6,ACTIVO_ALTO);//en=0;
  92   1      }
  93          
  94          /*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  95                  Bringing Cursor to (X,Y) location of LCD
  96                          X -> 1,2
  97                          Y -> 1,16
  98          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
  99          
 100          void cursorxy(bit_8 x, bit_8 y)
 101          {
 102   1              if((x<1||x>2)&&(y<1||y>16))
 103   1              {
 104   2                      x=1;
 105   2                      y=1;
 106   2              }
 107   1              if(x == 1)
 108   1                      wrt_cmd(0x7F+y);
 109   1              else
 110   1                      wrt_cmd(0xBF+y);
 111   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    208    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.50a   LCD                                                                  12/12/2012 13:56:50 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
